- name: Python setup with pyenv
  tags:
    - arch
    - ubuntu
    - macos
  block:
    - name: Install Pyenv
      ansible.builtin.homebrew:
        name: pyenv
        state: present
        update_homebrew: yes
    - name: Configure pyenv
      block:
        - name: Create pyenv dir
          ansible.builtin.file:
            path: "{{ lookup('env', 'HOME') }}/.pyenv"
            state: directory
            mode: '0755'
        - name: Add pyenv to path
          lineinfile:
            path: "{{ lookup('env', 'HOME') }}/.zshrc"
            line: 'export PYENV_ROOT="$HOME/.pyenv"'
        - name: Add pyenv root to path
          lineinfile:
            path: "{{ lookup('env', 'HOME') }}/.zshrc"
            line: '[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"'
        - name: Add pyenv initializer
          lineinfile:
            path: "{{ lookup('env', 'HOME') }}/.zshrc"
            line: 'eval "$(pyenv init -)"'
